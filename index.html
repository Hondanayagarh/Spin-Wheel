<div id="tokenPopup" style="display:flex; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:9999;">
  <div style="background:#fff; padding:20px; border-radius:10px; text-align:center; width:300px;">
    <h3>Enter Purchase Token</h3>
    <input id="tokenInput" placeholder="Enter token" style="padding:10px; width:90%; margin-bottom:10px;">
    <button onclick="checkToken()">Submit</button>
    <p id="tokenMessage" style="color:red; font-size:14px;"></p>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyjwF1_W7x_52piUobgAPfW59qcL7nF3k-VISNrydskQqx9Qpdbdj9BCufghuSfH3hZ/exec";

async function checkToken() {
  let token = document.getElementById("tokenInput").value.trim();
  if (!token) return;

  try {
    let res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({token: token}),
      headers: {"Content-Type": "application/json"}
    });

    let data = await res.json();
    console.log("Response:", data);

    if (data.status === "valid") {
      document.getElementById("tokenMessage").style.color = "green";
      document.getElementById("tokenMessage").innerText = "‚úÖ Valid token! Now spin the wheel.";
    } else if (data.status === "already") {
      document.getElementById("tokenMessage").style.color = "orange";
      document.getElementById("tokenMessage").innerText = "üéÅ Already used. You won: " + data.prize;
    } else if (data.status === "invalid") {
      document.getElementById("tokenMessage").style.color = "red";
      document.getElementById("tokenMessage").innerText = "‚ùå Invalid token.";
    } else {
      document.getElementById("tokenMessage").style.color = "red";
      document.getElementById("tokenMessage").innerText = "‚ö†Ô∏è Error: " + data.message;
    }
  } catch (err) {
    console.error(err);
    document.getElementById("tokenMessage").innerText = "‚ö†Ô∏è Network error: " + err;
  }
}
</script>
